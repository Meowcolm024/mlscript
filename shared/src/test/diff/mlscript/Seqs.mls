
class Seq[A]: { size: int }
//│ Defined class Seq

class ListBase[A]: Seq[A]
//│ Defined class ListBase

class Nil: ListBase[nothing] & {}
class Cons[A]: ListBase[A] & { head: A; tail: List[A] }
type List[A] = Nil | Cons[A]
//│ Defined class Nil
//│ Defined class Cons
//│ Defined type List

:e
Nil{}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.16: 	Nil{}
//│ ║        	^^^^^
//│ ╟── expression of type `anything` does not match type `listBase`
//│ ║  l.16: 	Nil{}
//│ ║        	   ^^
//│ ╟── Note: constraint arises from applied type reference:
//│ ║  l.8: 	class Nil: ListBase[nothing] & {}
//│ ╙──     	           ^^^^^^^^^^^^^^^^^
//│ res: (nil & ListBase[nothing]) | error

def Nil = Nil (ListBase (Seq { size = 0 }))
//│ Nil: nil & ListBase[nothing]

// FIXME type of head...
def Cons head tail =
  Cons (ListBase (Seq { size = succ tail.size }) with { head; tail })
//│ /!!!\ Uncaught error: java.lang.Exception: Internal Error: ~(~({tail: [α14']})\head-tail)\head-tail (class mlscript.TyperDatatypes$Without)
//│ 	at: mlscript.utils.package$.lastWords(package.scala:135)
//│ 	at: mlscript.TyperHelpers$SimpleTypeImpl.pushPosWithout(TyperHelpers.scala:112)
//│ 	at: mlscript.TyperHelpers$SimpleTypeImpl.pushPosWithout$(TyperHelpers.scala:103)
//│ 	at: mlscript.TyperDatatypes$SimpleType.pushPosWithout(TyperDatatypes.scala:34)
//│ 	at: mlscript.ConstraintSolver.$anonfun$constrain$3(ConstraintSolver.scala:105)
//│ 	at: mlscript.utils.package$ListHelpers.mapHead(package.scala:121)
//│ 	at: mlscript.ConstraintSolver.annoying$1(ConstraintSolver.scala:105)
//│ 	at: mlscript.ConstraintSolver.$anonfun$constrain$4(ConstraintSolver.scala:148)
//│ 	at: scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:17)

Nil: ListBase[anything]
//│ res: ListBase[anything]

